<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFP ìš”êµ¬ì‚¬í•­ ë·°ì–´ ë° í¸ì§‘ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .req-card { transition: all 0.2s; }
        .req-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen p-6">
        <div class="max-w-7xl mx-auto">
            <!-- í—¤ë” -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6 sticky top-0 z-50">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">RFP ìš”êµ¬ì‚¬í•­ ë·°ì–´</h1>
                        <p class="text-sm text-gray-600 mt-1">ì´ <span id="totalCount" class="font-bold text-blue-600">0</span>ê°œ ìš”êµ¬ì‚¬í•­ | í•„í„°ë§ ê²°ê³¼: <span id="filteredCount" class="font-bold text-green-600">0</span>ê°œ | ì ê¸ˆ: <span id="lockedCount" class="font-bold text-yellow-600">0</span>ê°œ</p>
                    </div>
                    <div class="flex gap-2 flex-wrap">
                        <select id="jsonFileSelect" onchange="loadSelectedJson()" class="px-4 py-2 bg-white border-2 border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 shadow-sm font-medium">
                            <option value="">ğŸ“ JSON íŒŒì¼ ì„ íƒ...</option>
                        </select>
                        <button onclick="loadJsonFileList()" class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 shadow-sm" title="íŒŒì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨">
                            ğŸ”„
                        </button>
                        <button onclick="loadJsonFile()" class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-sm">
                            ğŸ’¾ ë¡œì»¬ íŒŒì¼
                        </button>
                        <input id="jsonFileInput" type="file" accept=".json" class="hidden" />
                        <button onclick="addNewRequirement()" class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 shadow-sm">
                            â• ìš”êµ¬ì‚¬í•­ ì¶”ê°€
                        </button>
                        <button onclick="exportToJSON()" class="flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 shadow-sm">
                            ğŸ’¾ JSON ì €ì¥
                        </button>
                        <button onclick="exportToExcel()" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 shadow-sm">
                            ğŸ“Š Excel ë‚´ë³´ë‚´ê¸°
                        </button>
                    </div>
                </div>

                <!-- í•„í„° ë°” -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-gray-200 rounded-lg p-4">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">ê¸°ëŠ¥ID</label>
                            <input id="filterFunctionId" type="text" placeholder="F-001"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">ì„œë¹„ìŠ¤ ë¶„ì•¼</label>
                            <select id="filterServiceArea"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="">ì „ì²´</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">ì„œë¹„ìŠ¤ ì¤‘ë¶„ë¥˜</label>
                            <select id="filterServiceCategory"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="">ì „ì²´</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">ìš”êµ¬ì‚¬í•­ ë¶„ë¥˜</label>
                            <select id="filterReqType"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="">ì „ì²´</option>
                                <option value="ê¸°ëŠ¥ìš”êµ¬ì‚¬í•­(FR)">ê¸°ëŠ¥ìš”êµ¬ì‚¬í•­(FR)</option>
                                <option value="ë°ì´í„°ìš”êµ¬ì‚¬í•­(DR)">ë°ì´í„°ìš”êµ¬ì‚¬í•­(DR)</option>
                                <option value="ì„±ëŠ¥ìš”êµ¬ì‚¬í•­(PR)">ì„±ëŠ¥ìš”êµ¬ì‚¬í•­(PR)</option>
                                <option value="ë³´ì•ˆìš”êµ¬ì‚¬í•­(SR)">ë³´ì•ˆìš”êµ¬ì‚¬í•­(SR)</option>
                                <option value="í’ˆì§ˆìš”êµ¬ì‚¬í•­(QR)">í’ˆì§ˆìš”êµ¬ì‚¬í•­(QR)</option>
                                <option value="ì¸í„°í˜ì´ìŠ¤ìš”êµ¬ì‚¬í•­(IR)">ì¸í„°í˜ì´ìŠ¤ìš”êµ¬ì‚¬í•­(IR)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">ê²€ìƒ‰</label>
                            <input id="filterSearch" type="text" placeholder="ê¸°ëŠ¥ëª…, ë‚´ìš© ê²€ìƒ‰"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" />
                        </div>
                    </div>
                    <div class="mt-3 flex justify-between items-center">
                        <button onclick="resetFilters()" class="text-sm text-gray-600 hover:text-gray-900 underline">
                            í•„í„° ì´ˆê¸°í™”
                        </button>
                        <div class="flex gap-2">
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="showOnlyAI" class="rounded" />
                                <span>AI ìƒì„±ë§Œ ë³´ê¸°</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="showOnlyLocked" class="rounded" />
                                <span>ì ê¸´ í•­ëª©ë§Œ ë³´ê¸°</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="showOnlyUnlocked" class="rounded" />
                                <span>ì•ˆ ì ê¹€ í•­ëª©ë§Œ ë³´ê¸°</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìš”êµ¬ì‚¬í•­ ëª©ë¡ -->
            <div id="requirements-list" class="space-y-4"></div>

            <!-- ë¡œë”© ìƒíƒœ -->
            <div id="loading" class="hidden text-center py-12">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                <p class="mt-4 text-gray-600">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <!-- ë¹ˆ ìƒíƒœ -->
            <div id="empty-state" class="hidden text-center py-12 bg-white rounded-lg shadow-sm">
                <p class="text-xl text-gray-600 mb-4">ğŸ“‹ ìš”êµ¬ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p>
                <button onclick="loadJsonFile()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
            </div>
        </div>
    </div>

    <script>
        let requirements = [];
        let originalData = [];
        let lockedRequirements = new Set(); // ì ê¸´ ìš”êµ¬ì‚¬í•­ ì¸ë±ìŠ¤ ì €ì¥

        // ì ê¸ˆ ìƒíƒœ ë³µì›
        function restoreLockState(data) {
            lockedRequirements = new Set();
            data.forEach((req, index) => {
                if (req.locked === true) {
                    lockedRequirements.add(index);
                }
            });
        }

        // GitHubì—ì„œ JSON íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        async function loadJsonFileList() {
            const select = document.getElementById('jsonFileSelect');
            
            try {
                // GitHub APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì €ì¥ì†Œì˜ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('https://api.github.com/repos/jinbless/rfp-viewer/contents/');
                
                if (!response.ok) {
                    console.error('GitHub API í˜¸ì¶œ ì‹¤íŒ¨, ê¸°ë³¸ íŒŒì¼ ëª©ë¡ ì‚¬ìš©');
                    loadDefaultFileList();
                    return;
                }
                
                const files = await response.json();
                
                // JSON íŒŒì¼ë§Œ í•„í„°ë§
                const jsonFiles = files
                    .filter(file => file.name.endsWith('.json') && file.type === 'file')
                    .sort((a, b) => {
                        // ë²„ì „ íŒŒì¼ì„ ë¨¼ì €, ë‚˜ë¨¸ì§€ëŠ” ì´ë¦„ìˆœ
                        const aIsVersion = a.name.match(/^v\d+\.\d+/);
                        const bIsVersion = b.name.match(/^v\d+\.\d+/);
                        if (aIsVersion && !bIsVersion) return 1;
                        if (!aIsVersion && bIsVersion) return -1;
                        return a.name.localeCompare(b.name);
                    });
                
                // ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                select.innerHTML = '<option value="">ğŸ“ JSON íŒŒì¼ ì„ íƒ</option>' + 
                    jsonFiles.map(file => {
                        const displayName = getDisplayName(file.name);
                        return `<option value="${file.name}">${displayName}</option>`;
                    }).join('');
                    
                console.log(`âœ… ${jsonFiles.length}ê°œì˜ JSON íŒŒì¼ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
                
            } catch (error) {
                console.error('JSON íŒŒì¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                loadDefaultFileList();
            }
        }

        // íŒŒì¼ëª…ì„ í‘œì‹œìš© ì´ë¦„ìœ¼ë¡œ ë³€í™˜
        function getDisplayName(fileName) {
            // ê¸°ì¡´ íŒŒì¼ë“¤ì— ëŒ€í•œ ë§¤í•‘
            const nameMap = {
                'RFP_ì™„ì„±ë³¸_NFRìë™ìƒì„±.json': 'ğŸ“„ RFP ì™„ì„±ë³¸ (NFR ìë™ìƒì„±)',
                'RFP_ì™„ì„±ë³¸_NFRìë™ìƒì„±_fixed.json': 'ğŸ“„ RFP ì™„ì„±ë³¸ (ìˆ˜ì •ë³¸)',
                'RFP_ì¬êµ¬ì¡°í™”_ê²°ê³¼.json': 'ğŸ“„ RFP ì¬êµ¬ì¡°í™” ê²°ê³¼'
            };
            
            if (nameMap[fileName]) {
                return nameMap[fileName];
            }
            
            // ë²„ì „ íŒŒì¼ ì²˜ë¦¬ (ì˜ˆ: v1.1_RFP_ìš”êµ¬ì‚¬í•­_2025-10-14.json)
            const versionMatch = fileName.match(/^(v[\d.]+)_.*(\d{4}-\d{2}-\d{2})\.json$/);
            if (versionMatch) {
                return `ğŸ“Œ ${versionMatch[1]} (${versionMatch[2]})`;
            }
            
            // ê¸°ë³¸: íŒŒì¼ëª… ê·¸ëŒ€ë¡œ í‘œì‹œ
            return `ğŸ“„ ${fileName.replace('.json', '')}`;
        }

        // ê¸°ë³¸ íŒŒì¼ ëª©ë¡ (API ì‹¤íŒ¨ ì‹œ)
        function loadDefaultFileList() {
            const select = document.getElementById('jsonFileSelect');
            select.innerHTML = `
                <option value="">ğŸ“ JSON íŒŒì¼ ì„ íƒ</option>
                <option value="RFP_ì™„ì„±ë³¸_NFRìë™ìƒì„±.json">ğŸ“„ RFP ì™„ì„±ë³¸ (NFR ìë™ìƒì„±)</option>
                <option value="RFP_ì™„ì„±ë³¸_NFRìë™ìƒì„±_fixed.json">ğŸ“„ RFP ì™„ì„±ë³¸ (ìˆ˜ì •ë³¸)</option>
                <option value="RFP_ì¬êµ¬ì¡°í™”_ê²°ê³¼.json">ğŸ“„ RFP ì¬êµ¬ì¡°í™” ê²°ê³¼</option>
                <option value="v1.1_RFP_ìš”êµ¬ì‚¬í•­_2025-10-14.json">ğŸ“Œ v1.1 (2025-10-14)</option>
                <option value="v1.2_RFP_ìš”êµ¬ì‚¬í•­_2025-10-14.json">ğŸ“Œ v1.2 (2025-10-14)</option>
            `;
        }

        // ë°ì´í„° ë¡œë“œ
        async function loadDefaultData() {
            try {
                const response = await fetch('RFP_ì™„ì„±ë³¸_NFRìë™ìƒì„±.json');
                if (response.ok) {
                    const data = await response.json();
                    requirements = data;
                    originalData = JSON.parse(JSON.stringify(data));
                    restoreLockState(data); // ì ê¸ˆ ìƒíƒœ ë³µì›
                    initializeFilters();
                    renderRequirements();
                }
            } catch (error) {
                console.log('ê¸°ë³¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // GitHubì—ì„œ ì„ íƒëœ JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadSelectedJson() {
            const select = document.getElementById('jsonFileSelect');
            const fileName = select.value;
            
            if (!fileName) return;

            try {
                const response = await fetch(fileName);
                if (!response.ok) throw new Error('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                
                const data = await response.json();
                requirements = data;
                originalData = JSON.parse(JSON.stringify(data));
                restoreLockState(data); // ì ê¸ˆ ìƒíƒœ ë³µì›
                initializeFilters();
                renderRequirements();
                
                const lockCount = lockedRequirements.size;
                const lockInfo = lockCount > 0 ? ` (ì ê¸ˆ: ${lockCount}ê°œ)` : '';
                alert(`âœ… ${select.options[select.selectedIndex].text} íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!${lockInfo}`);
            } catch (error) {
                alert('âŒ JSON íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ' + error.message);
                select.value = ''; // ì„ íƒ ì´ˆê¸°í™”
            }
        }

        // ë¡œì»¬ JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadJsonFile() {
            document.getElementById('jsonFileInput').click();
        }

        document.getElementById('jsonFileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    requirements = data;
                    originalData = JSON.parse(JSON.stringify(data));
                    restoreLockState(data); // ì ê¸ˆ ìƒíƒœ ë³µì›
                    document.getElementById('jsonFileSelect').value = ''; // ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
                    initializeFilters();
                    renderRequirements();
                    
                    const lockCount = lockedRequirements.size;
                    const lockInfo = lockCount > 0 ? ` (ì ê¸ˆ: ${lockCount}ê°œ)` : '';
                    alert(`âœ… ë¡œì»¬ JSON íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!${lockInfo}`);
                } catch (error) {
                    alert('âŒ JSON íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ' + error.message);
                }
            };
            reader.readAsText(file);
        });

        // í•„í„° ì´ˆê¸°í™”
        function initializeFilters() {
            const serviceAreas = [...new Set(requirements.map(r => r['ì„œë¹„ìŠ¤ë¶„ì•¼']).filter(Boolean))];
            const serviceCategories = [...new Set(requirements.map(r => r['ì„œë¹„ìŠ¤ì¤‘ë¶„ë¥˜']).filter(Boolean))];

            const areaSelect = document.getElementById('filterServiceArea');
            areaSelect.innerHTML = '<option value="">ì „ì²´</option>' +
                serviceAreas.map(a => `<option value="${a}">${a}</option>`).join('');

            const categorySelect = document.getElementById('filterServiceCategory');
            categorySelect.innerHTML = '<option value="">ì „ì²´</option>' +
                serviceCategories.map(c => `<option value="${c}">${c}</option>`).join('');

            // í•„í„° ì´ë²¤íŠ¸ ë°”ì¸ë”©
            ['filterFunctionId', 'filterServiceArea', 'filterServiceCategory', 'filterReqType', 'filterSearch', 'showOnlyAI', 'showOnlyLocked', 'showOnlyUnlocked'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener(element.type === 'checkbox' ? 'change' : 'input', renderRequirements);
                }
            });
        }

        // ìƒìœ„ ìš”êµ¬ì‚¬í•­ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
        function getParentFunctionName(req) {
            // 1ìˆœìœ„: JSONì— ì§ì ‘ ì €ì¥ëœ 'ìƒìœ„ìš”êµ¬ì‚¬í•­ë‚´ìš©' ì‚¬ìš©
            if (req['ìƒìœ„ìš”êµ¬ì‚¬í•­ë‚´ìš©']) {
                return req['ìƒìœ„ìš”êµ¬ì‚¬í•­ë‚´ìš©'];
            }
            
            // 2ìˆœìœ„: ìƒìœ„ê¸°ëŠ¥IDë¡œ ìë™ ìƒì„± (í•˜ìœ„ í˜¸í™˜ì„±)
            if (!req['ìƒìœ„ê¸°ëŠ¥ID']) return '';
            
            // ìƒìœ„ê¸°ëŠ¥IDë¡œ ìš”êµ¬ì‚¬í•­ ì°¾ê¸°
            const parentReq = requirements.find(r => r['ê¸°ëŠ¥ID'] === req['ìƒìœ„ê¸°ëŠ¥ID']);
            
            // ìƒìœ„ ìš”êµ¬ì‚¬í•­ì´ ìˆìœ¼ë©´ ê·¸ ìš”êµ¬ì‚¬í•­ë‚´ìš© ë°˜í™˜
            if (parentReq && parentReq['ìš”êµ¬ì‚¬í•­ë‚´ìš©']) {
                return parentReq['ìš”êµ¬ì‚¬í•­ë‚´ìš©'];
            }
            
            // ì°¾ì§€ ëª»í•˜ë©´ ë¹ˆ ê°’
            return '';
        }

        // í•„í„°ë§ëœ ìš”êµ¬ì‚¬í•­ ê°€ì ¸ì˜¤ê¸°
        function getFilteredRequirements() {
            const functionId = document.getElementById('filterFunctionId').value.toLowerCase();
            const serviceArea = document.getElementById('filterServiceArea').value;
            const serviceCategory = document.getElementById('filterServiceCategory').value;
            const reqType = document.getElementById('filterReqType').value;
            const searchText = document.getElementById('filterSearch').value.toLowerCase();
            const showOnlyAI = document.getElementById('showOnlyAI').checked;
            const showOnlyLocked = document.getElementById('showOnlyLocked').checked;
            const showOnlyUnlocked = document.getElementById('showOnlyUnlocked').checked;

            return requirements.filter((req, index) => {
                if (functionId && !String(req['ê¸°ëŠ¥ID']).toLowerCase().includes(functionId)) return false;
                if (serviceArea && req['ì„œë¹„ìŠ¤ë¶„ì•¼'] !== serviceArea) return false;
                if (serviceCategory && req['ì„œë¹„ìŠ¤ì¤‘ë¶„ë¥˜'] !== serviceCategory) return false;
                if (reqType && req['ìš”êµ¬ì‚¬í•­ë¶„ë¥˜'] !== reqType) return false;
                if (showOnlyAI && req['ë¹„ê³ '] !== 'AI ìë™ ìƒì„±') return false;
                
                // ì ê¸ˆ ìƒíƒœ í•„í„° (ë‘˜ ë‹¤ ì²´í¬ë˜ë©´ ëª¨ë‘ í‘œì‹œ)
                if (showOnlyLocked && !showOnlyUnlocked && !lockedRequirements.has(index)) return false;
                if (showOnlyUnlocked && !showOnlyLocked && lockedRequirements.has(index)) return false;
                
                if (searchText) {
                    const parentFunctionName = getParentFunctionName(req);
                    const searchableText = [
                        req['ê¸°ëŠ¥ëª…'],
                        parentFunctionName,
                        req['ìš”êµ¬ì‚¬í•­ë‚´ìš©']
                    ].join(' ').toLowerCase();
                    if (!searchableText.includes(searchText)) return false;
                }
                return true;
            });
        }

        // ìš”êµ¬ì‚¬í•­ ë Œë”ë§
        function renderRequirements() {
            const filtered = getFilteredRequirements();
            const container = document.getElementById('requirements-list');
            const emptyState = document.getElementById('empty-state');

            document.getElementById('totalCount').textContent = requirements.length;
            document.getElementById('filteredCount').textContent = filtered.length;
            document.getElementById('lockedCount').textContent = lockedRequirements.size;

            if (requirements.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 bg-white rounded-lg shadow-sm">
                        <p class="text-xl text-gray-600">ğŸ” í•„í„° ì¡°ê±´ì— ë§ëŠ” ìš”êµ¬ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map((req, index) => {
                const reqIndex = requirements.indexOf(req);
                const isAI = req['ë¹„ê³ '] === 'AI ìë™ ìƒì„±';
                const isLocked = lockedRequirements.has(reqIndex);
                const reqTypeColor = {
                    'ê¸°ëŠ¥ìš”êµ¬ì‚¬í•­(FR)': 'bg-blue-100 text-blue-800',
                    'ë°ì´í„°ìš”êµ¬ì‚¬í•­(DR)': 'bg-green-100 text-green-800',
                    'ì„±ëŠ¥ìš”êµ¬ì‚¬í•­(PR)': 'bg-yellow-100 text-yellow-800',
                    'ë³´ì•ˆìš”êµ¬ì‚¬í•­(SR)': 'bg-red-100 text-red-800',
                    'í’ˆì§ˆìš”êµ¬ì‚¬í•­(QR)': 'bg-purple-100 text-purple-800',
                    'ì¸í„°í˜ì´ìŠ¤ìš”êµ¬ì‚¬í•­(IR)': 'bg-pink-100 text-pink-800',
                }[req['ìš”êµ¬ì‚¬í•­ë¶„ë¥˜']] || 'bg-gray-100 text-gray-800';

                return `
                    <div class="req-card ${isLocked ? 'bg-gray-100 opacity-75' : 'bg-white'} rounded-lg shadow-sm border-l-4 ${isLocked ? 'border-gray-500' : (isAI ? 'border-purple-500' : 'border-blue-500')}"">
                        <div class="p-6 ${isLocked ? 'relative' : ''}">
                            ${isLocked ? '<div class="absolute top-2 right-2 text-2xl opacity-20">ğŸ”’</div>' : ''}
                            <!-- í—¤ë” -->
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-3 flex-wrap">
                                    <span class="px-3 py-1 bg-gray-800 text-white rounded-full font-bold text-sm">
                                        ${req['ê¸°ëŠ¥ID']}
                                    </span>
                                    ${req['ìƒìœ„ê¸°ëŠ¥ID'] ? `
                                        <span class="px-2 py-1 bg-gray-200 text-gray-700 rounded text-xs">
                                            â†³ ${req['ìƒìœ„ê¸°ëŠ¥ID']}
                                        </span>
                                    ` : ''}
                                    <span class="px-3 py-1 ${reqTypeColor} rounded-full font-semibold text-sm">
                                        ${req['ìš”êµ¬ì‚¬í•­ë¶„ë¥˜']}
                                    </span>
                                    ${isAI ? `
                                        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium">
                                            ğŸ¤– AI ìƒì„±
                                        </span>
                                    ` : ''}
                                    ${isLocked ? `
                                        <span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-medium">
                                            ğŸ”’ ì ê¹€
                                        </span>
                                    ` : ''}
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="toggleLock(${reqIndex})"
                                        class="px-3 py-1 ${isLocked ? 'bg-yellow-50 text-yellow-600 hover:bg-yellow-100' : 'bg-gray-50 text-gray-600 hover:bg-gray-100'} rounded text-sm font-medium">
                                        ${isLocked ? 'ğŸ”“ ì ê¸ˆí•´ì œ' : 'ğŸ”’ ì ê¸ˆ'}
                                    </button>
                                    <button onclick="editRequirement(${reqIndex})" ${isLocked ? 'disabled' : ''}
                                        class="px-3 py-1 ${isLocked ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-blue-50 text-blue-600 hover:bg-blue-100'} rounded text-sm font-medium">
                                        âœï¸ ìˆ˜ì •
                                    </button>
                                    <button onclick="deleteRequirement(${reqIndex})" ${isLocked ? 'disabled' : ''}
                                        class="px-3 py-1 ${isLocked ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-red-50 text-red-600 hover:bg-red-100'} rounded text-sm font-medium">
                                        ğŸ—‘ï¸ ì‚­ì œ
                                    </button>
                                </div>
                            </div>

                            <!-- ë‚´ìš© -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <span class="text-xs font-semibold text-gray-500 uppercase">ì„œë¹„ìŠ¤ ë¶„ì•¼</span>
                                    <p class="text-sm text-gray-900 mt-1">${req['ì„œë¹„ìŠ¤ë¶„ì•¼'] || '-'}</p>
                                </div>
                                <div>
                                    <span class="text-xs font-semibold text-gray-500 uppercase">ì„œë¹„ìŠ¤ ì¤‘ë¶„ë¥˜</span>
                                    <p class="text-sm text-gray-900 mt-1">${req['ì„œë¹„ìŠ¤ì¤‘ë¶„ë¥˜'] || '-'}</p>
                                </div>
                            </div>

                            <div class="mb-4">
                                <span class="text-xs font-semibold text-gray-500 uppercase">ê¸°ëŠ¥ëª…</span>
                                <p class="text-base font-medium text-gray-900 mt-1">${req['ê¸°ëŠ¥ëª…'] || '-'}</p>
                            </div>

                            ${getParentFunctionName(req) ? `
                                <div class="mb-4">
                                    <span class="text-xs font-semibold text-gray-500 uppercase">ìƒìœ„ ìš”êµ¬ì‚¬í•­ ë‚´ìš©</span>
                                    <p class="text-sm text-gray-700 mt-1">${getParentFunctionName(req)}</p>
                                </div>
                            ` : ''}

                            <div class="mb-4">
                                <span class="text-xs font-semibold text-gray-500 uppercase">ìš”êµ¬ì‚¬í•­ ë‚´ìš©</span>
                                <div class="mt-2 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                    <pre class="text-sm text-gray-800 whitespace-pre-wrap font-sans">${req['ìš”êµ¬ì‚¬í•­ë‚´ìš©'] || '-'}</pre>
                                </div>
                            </div>

                            ${req['ì‚°ì¶œì •ë³´'] ? `
                                <div>
                                    <span class="text-xs font-semibold text-gray-500 uppercase">ì‚°ì¶œì •ë³´</span>
                                    <p class="text-sm text-gray-700 mt-1">${req['ì‚°ì¶œì •ë³´']}</p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ìš”êµ¬ì‚¬í•­ ìˆ˜ì •
        function editRequirement(index) {
            if (lockedRequirements.has(index)) {
                alert('âš ï¸ ì ê¸´ ìš”êµ¬ì‚¬í•­ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì ê¸ˆì„ í•´ì œí•˜ì„¸ìš”.');
                return;
            }
            const req = requirements[index];

            // ëª¨ë‹¬ ì°½ ìƒì„±
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4">
                        <h2 class="text-2xl font-bold text-gray-900">ìš”êµ¬ì‚¬í•­ ìˆ˜ì •</h2>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ê¸°ëŠ¥ëª…</label>
                            <input type="text" id="edit-function-name" value="${escapeHtml(req['ê¸°ëŠ¥ëª…'] || '')}"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ìš”êµ¬ì‚¬í•­ ë‚´ìš©</label>
                            <textarea id="edit-requirement-content" rows="8"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">${escapeHtml(req['ìš”êµ¬ì‚¬í•­ë‚´ìš©'] || '')}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ì‚°ì¶œì •ë³´</label>
                            <input type="text" id="edit-output-info" value="${escapeHtml(req['ì‚°ì¶œì •ë³´'] || '')}"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" />
                        </div>
                    </div>
                    <div class="sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-end gap-3 border-t border-gray-200">
                        <button onclick="closeEditModal()"
                            class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium">
                            ì·¨ì†Œ
                        </button>
                        <button onclick="saveEditedRequirement(${index})"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                            ì €ì¥
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.id = 'edit-modal';
        }

        // ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditModal() {
            const modal = document.getElementById('edit-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ìˆ˜ì • ë‚´ìš© ì €ì¥
        function saveEditedRequirement(index) {
            const functionName = document.getElementById('edit-function-name').value;
            const requirementContent = document.getElementById('edit-requirement-content').value;
            const outputInfo = document.getElementById('edit-output-info').value;

            requirements[index]['ê¸°ëŠ¥ëª…'] = functionName;
            requirements[index]['ìš”êµ¬ì‚¬í•­ë‚´ìš©'] = requirementContent;
            requirements[index]['ì‚°ì¶œì •ë³´'] = outputInfo;
            requirements[index]['ë¹„ê³ '] = requirements[index]['ë¹„ê³ '] === 'AI ìë™ ìƒì„±' ? 'AI ìƒì„± (ì‚¬ìš©ì ìˆ˜ì •)' : 'ì‚¬ìš©ì ìˆ˜ì •';

            closeEditModal();
            renderRequirements();
            alert('âœ… ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ì ê¸ˆ/ì ê¸ˆí•´ì œ
        function toggleLock(index) {
            if (lockedRequirements.has(index)) {
                lockedRequirements.delete(index);
            } else {
                lockedRequirements.add(index);
            }
            renderRequirements();
        }

        // ìš”êµ¬ì‚¬í•­ ì‚­ì œ
        function deleteRequirement(index) {
            if (lockedRequirements.has(index)) {
                alert('âš ï¸ ì ê¸´ ìš”êµ¬ì‚¬í•­ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì ê¸ˆì„ í•´ì œí•˜ì„¸ìš”.');
                return;
            }
            if (confirm('ì´ ìš”êµ¬ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                requirements.splice(index, 1);
                // ì¸ë±ìŠ¤ ì¬ì¡°ì •
                const newLockedRequirements = new Set();
                lockedRequirements.forEach(lockedIndex => {
                    if (lockedIndex < index) {
                        newLockedRequirements.add(lockedIndex);
                    } else if (lockedIndex > index) {
                        newLockedRequirements.add(lockedIndex - 1);
                    }
                });
                lockedRequirements = newLockedRequirements;
                renderRequirements();
                alert('âœ… ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // ìƒˆ ìš”êµ¬ì‚¬í•­ ì¶”ê°€
        function addNewRequirement() {
            const newReq = {
                'ê¸°ëŠ¥ID': `F-NEW-${Date.now()}`,
                'ìƒìœ„ê¸°ëŠ¥ID': '',
                'ì„œë¹„ìŠ¤ë¶„ì•¼': '',
                'ì„œë¹„ìŠ¤ì¤‘ë¶„ë¥˜': '',
                'ê¸°ëŠ¥ëª…': 'ìƒˆ ìš”êµ¬ì‚¬í•­',
                'ìƒìœ„ìš”êµ¬ì‚¬í•­ë‚´ìš©': '',
                'ìš”êµ¬ì‚¬í•­ë¶„ë¥˜': 'ê¸°ëŠ¥ìš”êµ¬ì‚¬í•­(FR)',
                'ìš”êµ¬ì‚¬í•­ë‚´ìš©': '',
                'ì‚°ì¶œì •ë³´': '',
                'ë¹„ê³ ': 'ì‚¬ìš©ì ì¶”ê°€'
            };
            requirements.push(newReq);
            renderRequirements();
            alert('âœ… ìƒˆ ìš”êµ¬ì‚¬í•­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // JSON ì €ì¥ (ì ê¸ˆ ìƒíƒœ í¬í•¨)
        function exportToJSON() {
            const version = prompt('ë²„ì „ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: v1.0):', 'v1.0');
            if (!version) return;

            // ì ê¸ˆ ìƒíƒœë¥¼ í¬í•¨í•œ ë°ì´í„° ë³µì‚¬
            const dataWithLock = requirements.map((req, index) => ({
                ...req,
                locked: lockedRequirements.has(index)
            }));

            const jsonStr = JSON.stringify(dataWithLock, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${version}_RFP_ìš”êµ¬ì‚¬í•­_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('âœ… JSON íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ì ê¸ˆ ìƒíƒœ í¬í•¨)');
        }

        // Excel ë‚´ë³´ë‚´ê¸° (CSV)
        function exportToExcel() {
            const headers = ['ê¸°ëŠ¥ID', 'ìƒìœ„ê¸°ëŠ¥ID', 'ì„œë¹„ìŠ¤ë¶„ì•¼', 'ì„œë¹„ìŠ¤ì¤‘ë¶„ë¥˜', 'ê¸°ëŠ¥ëª…', 'ìƒìœ„ìš”êµ¬ì‚¬í•­ë‚´ìš©',
                            'ìš”êµ¬ì‚¬í•­ë¶„ë¥˜', 'ìš”êµ¬ì‚¬í•­ë‚´ìš©', 'ì‚°ì¶œì •ë³´', 'ë¹„ê³ '];

            const rows = requirements.map(req => headers.map(h => {
                const value = req[h] || '';
                return `"${String(value).replace(/"/g, '""')}"`;
            }));

            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `RFP_ìš”êµ¬ì‚¬í•­_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            alert('âœ… CSV íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('filterFunctionId').value = '';
            document.getElementById('filterServiceArea').value = '';
            document.getElementById('filterServiceCategory').value = '';
            document.getElementById('filterReqType').value = '';
            document.getElementById('filterSearch').value = '';
            document.getElementById('showOnlyAI').checked = false;
            document.getElementById('showOnlyLocked').checked = false;
            document.getElementById('showOnlyUnlocked').checked = false;
            renderRequirements();
        }

        // ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            loadJsonFileList(); // JSON íŒŒì¼ ëª©ë¡ ë¨¼ì € ë¡œë“œ
            loadDefaultData();
        });
    </script>
</body>
</html>
